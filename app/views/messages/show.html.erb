<div class="container mt-4">
    <div class="row">
        <div class="col-12 col-md-8 offset-md-2">
            <%= link_to 'Back to all messages', messages_path, class: 'btn btn-info' %>
            <% if @message.user == current_user %> 
                <%= link_to 'Edit message', edit_message_path(@message.id), class: 'btn btn-dark' %>
            <% end %>
            <div class="card mt-4">
                <div class="card-img-top">
                    <%= image_tag('Funny-Cat-Jokes2.jpg', class: 'img-fluid') %>
                </div>
                <div class="card-body">
                    <div class="row">
                      <div class="col-12">
                        <div class="avatar-40 mb-3">
                          <% if @message.user.picture.present? %>
                            <%= image_tag(@message.user.picture.url) %>
                          <% else %>
                            <%= image_tag('default-avatar.png') %>
                          <% end %>
                          <% if @message.user.first_name.blank? && @message.user.last_name.blank? %>
                            <%= @message.user.email %>
                          <% else %>
                            <%= @message.user.first_name %> <%= @message.user.last_name %>
                          <% end %>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <h2> <%= @message.content %> </h2>
                        </div>
                    </div> 
                    <div class="row">
                        <div class="col-12 text-right">
                            <%= link_to 'Show', @message, class: 'btn btn-outline-primary btn-sm' %>
                            <% if @message.user.id == current_user.id %>
                                <%= link_to 'Edit', edit_message_path(@message.id), class: 'btn btn-outline-primary btn-sm' %>
                                <%= link_to 'Delete', @message, method: :delete, class: 'btn btn-outline-danger btn-sm' %>
                            <% end %>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 text-right text-secondary mt-3 mb-0">
                            <span class="message-date"> <%= @message.created_at.in_time_zone("CET").strftime("%F %T") %> </span>
                            <hr>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <% if @comments.count > 0 %>
                                <h5><strong> Comments </strong></h5>
                                <ul class="list-group">
                                    <%= render partial: 'comments', collection: @comments, as: :comment %>
                                </ul>
                            <% end %>
                        </div>
                    </div>
                </div>  
                <div class="card-footer text-right">
                    <%= link_to 'Comments: ' + @message.comments.count.to_s, comments_path({message_id: @message.id}), class: 'mr-2' %>
                    <%= link_to 'Comment', new_comment_path({message_id: @message.id}), class: 'btn btn-primary btn-sm' %>
                </div>
            </div>
        </div>
    </div>
</div>
